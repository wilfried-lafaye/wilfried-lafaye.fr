<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Phase Vocoder Speech - Wilfried Lafaye</title>
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&family=Outfit:wght@500;700&display=swap"
        rel="stylesheet">
    <!-- Styles -->
    <link rel="stylesheet" href="../css/style.css">
</head>

<body>

    <header class="navbar glass">
        <div class="nav-content">
            <a href="../index.html" class="logo">WL.</a>
            <nav>
                <a href="../index.html#projects">Back to Portfolio</a>
            </nav>
        </div>
    </header>

    <main style="padding-top: 6rem;">
        <section class="container">
            <div class="glass" style="padding: 2rem; border-radius: var(--radius-lg); margin-bottom: 2rem;">
                <h1 style="margin-bottom: 1rem;">Phase Vocoder Speech</h1>
                <p style="color: var(--text-secondary); margin-bottom: 2rem;">
                    A real-time audio processing application that modifies the speed of speech without altering its
                    pitch.
                    This project uses advanced signal processing techniques (STFT) to deconstruct and reconstruct audio
                    signals.
                </p>

                <!-- APP CONTAINER -->
                <div id="app-container" class="app-container"
                    style="width: 100%; aspect-ratio: 16/9; background: #000; border-radius: var(--radius-md); overflow: hidden; border: 1px solid var(--glass-border); position: relative; display: flex; align-items: center; justify-content: center;">

                    <!-- SLEEPING STATE UI -->
                    <div id="sleep-ui" style="text-align: center; padding: 2rem; color: #fff;">
                        <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none"
                            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                            style="margin-bottom: 1rem; opacity: 0.7;">
                            <path d="M12 2a10 10 0 1 0 10 10 10 10 0 0 0-10-10z"></path>
                            <path d="M12 6v6l4 2"></path>
                        </svg>
                        <h3 style="margin-bottom: 0.5rem;">Application is Sleeping</h3>
                        <p
                            style="color: var(--text-secondary); margin-bottom: 1.5rem; max-width: 400px; margin-left: auto; margin-right: auto;">
                            To save resources, this server sleeps when idle. Waking it up may take about 1-2 minutes.
                        </p>
                        <button id="wake-btn" class="btn-primary" onclick="startApp()">
                            Start Application
                        </button>
                    </div>

                    <!-- LOADING STATE UI (Hidden by default) -->
                    <div id="loading-ui" style="display: none; text-align: center; color: #fff;">
                        <div class="spinner"
                            style="width: 40px; height: 40px; border: 4px solid rgba(255,255,255,0.1); border-left-color: var(--primary); border-radius: 50%; animation: spin 1s linear infinite; margin: 0 auto 1rem;">
                        </div>
                        <h3 style="margin-bottom: 0.5rem;">Waking up server...</h3>
                        <p style="color: var(--text-secondary);">Please wait, this might take a moment.</p>
                    </div>

                    <!-- IFRAME (Injected via JS) -->
                    <!-- Iframe will be appended here -->
                </div>

                <div style="margin-top: 1rem; text-align: center;">
                    <p style="font-size: 0.8rem; color: var(--text-secondary);">
                        * Powered by Render Free Tier (On-Demand)
                    </p>
                </div>
            </div>

            <script>
                // CONFIGURATION
                const LOCAL_URL = "http://localhost:3000";
                const PROD_URL = "https://YOUR-RENDER-SERVICE-URL.onrender.com"; // [!] UPDATE THIS AFTER DEPLOYMENT

                function startApp() {
                    const container = document.getElementById('app-container');
                    const sleepUi = document.getElementById('sleep-ui');
                    const loadingUi = document.getElementById('loading-ui');

                    // 1. Show Loading UI
                    sleepUi.style.display = 'none';
                    loadingUi.style.display = 'block';

                    // 2. Determine URL
                    const isLocal = window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1';
                    const targetUrl = isLocal ? LOCAL_URL : PROD_URL;

                    console.log("Starting App at:", targetUrl);

                    // 3. Create and Load Iframe
                    const iframe = document.createElement('iframe');
                    iframe.src = targetUrl;
                    iframe.style.width = '100%';
                    iframe.style.height = '100%';
                    iframe.style.border = 'none';
                    iframe.style.position = 'absolute';
                    iframe.style.top = '0';
                    iframe.style.left = '0';
                    iframe.style.zIndex = '10'; // On top of loader
                    iframe.style.opacity = '0'; // Hidden initially
                    iframe.style.transition = 'opacity 0.5s ease';

                    // 4. Handle Load Event (Reveal when ready)
                    iframe.onload = () => {
                        console.log("Iframe loaded!");
                        // Small delay to ensure render
                        setTimeout(() => {
                            loadingUi.style.display = 'none';
                            iframe.style.opacity = '1';
                        }, 500);
                    };

                    // Append to container
                    container.appendChild(iframe);
                }

                // Styles for spinner
                const styleSheet = document.createElement("style");
                styleSheet.innerText = `
                    @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
                `;
                document.head.appendChild(styleSheet);
            </script>
            </div>

            <div class="glass" style="padding: 2rem; border-radius: var(--radius-lg);">
                <h2>Technical Details</h2>
                <ul style="margin-top: 1rem; padding-left: 1.5rem; list-style: disc; color: var(--text-secondary);">
                    <li><strong>Algorithm:</strong> Phase Vocoder (STFT / ISTFT)</li>
                    <li><strong>Language:</strong> Python (NumPy, SciPy)</li>
                    <li><strong>Interface:</strong> Web-based</li>
                </ul>
            </div>
        </section>
    </main>

    <footer>
        <p>&copy; 2025 Wilfried Lafaye</p>
    </footer>

</body>

</html>